<skuidpage unsavedchangeswarning="yes" personalizationmode="server" showsidebar="true" useviewportmeta="true" showheader="true" theme="ElixirThemepPlan">
  <models>
    <model id="CommonApplicationModel" limit="20" query="true" createrowifnonefound="false" datasource="salesforce" sobject="genesis__Applications__c">
      <fields>
        <field id="RecordTypeId"/>
        <field id="genesis__Status__c"/>
        <field id="genesis__Account__c"/>
        <field id="genesis__Account__r.Name"/>
        <field id="genesis__CL_Purpose__c"/>
        <field id="genesis__CL_Purpose__r.Name"/>
        <field id="genesis__CL_Product_Name__c"/>
        <field id="CreatedDate"/>
        <field id="CreatedBy.Name"/>
        <field id="genesis__Lending_Product__c"/>
        <field id="genesis__Lending_Product__r.Name"/>
        <field id="CreatedById"/>
        <field id="LastModifiedById"/>
        <field id="LastModifiedBy.Name"/>
        <field id="genesis__Balloon_Payment__c"/>
        <field id="genesis__Days_Convention__c"/>
        <field id="genesis__Loan_Amount__c"/>
        <field id="genesis__Term__c"/>
        <field id="genesis__Interest_Compounding_Frequency__c"/>
        <field id="genesis__Interest_Calculation_Method__c"/>
        <field id="genesis__Interest_Only_Period__c"/>
        <field id="genesis__Interest_Rate__c"/>
        <field id="genesis__Payment_Frequency__c"/>
        <field id="genesis__Funding_in_Tranches__c"/>
        <field id="genesis__Expected_Start_Date__c"/>
        <field id="genesis__Expected_First_Payment_Date__c"/>
        <field id="genesis__Maturity_Date__c"/>
        <field id="genesis__Payment_Due_Date__c"/>
        <field id="genesis__Draw_Period_End_Date__c"/>
        <field id="genesis__Amortization_Term__c"/>
        <field id="genesis__Product_Type__c"/>
        <field id="Name"/>
        <field id="genesis__Contact__c"/>
        <field id="genesis__Contact__r.Name"/>
        <field id="CL_Contract__c"/>
        <field id="CL_Contract__r.Name"/>
        <field id="Id"/>
        <field id="genesis__CL_Purpose__r.loan__Lending_Purpose__c"/>
        <field id="genesis__CL_Purpose__r.loan__Lending_Purpose__r.Name"/>
        <field id="genesis__CL_Product__r.loan__Lending_Product__c"/>
        <field id="genesis__CL_Product__r.loan__Lending_Product__r.Name"/>
        <field id="genesis__CL_Product__r.loan__Lending_Product__r.Id"/>
        <field id="Loan_Application__c"/>
        <field id="Loan_Application__r.Name"/>
        <field id="Loan_Application__r.peer__Loan__c"/>
        <field id="Loan_Application__r.peer__Loan__r.Name"/>
        <field id="Document_Type__c"/>
        <field id="Details_for_Interest_Only_Period__c"/>
        <field id="Additional_Requirements__c"/>
        <field id="Additional_Requirement_Details__c"/>
        <field id="Purchase__c"/>
        <field id="Purchase_Type__c"/>
        <field id="Submission_notes__c"/>
        <field id="genesis__Disbursement_Date__c"/>
      </fields>
      <conditions>
        <condition type="param" value="Id" field="Id" operator="=" enclosevalueinquotes="true" model="InvestmentBookModel"/>
      </conditions>
      <actions/>
    </model>
    <model id="Loan_Application" limit="20" query="true" createrowifnonefound="false" datasource="salesforce" sobject="peer__Loan_Application__c">
      <fields>
        <field id="peer__Loan__c"/>
        <field id="peer__Loan__r.Name"/>
      </fields>
      <conditions>
        <condition type="modelmerge" value="" field="Id" operator="=" model="CommonApplicationModel" enclosevalueinquotes="true" mergefield="Loan_Application__c" novaluebehavior="deactivate" fieldtargetobjects="peer__Loan_Application__c"/>
      </conditions>
      <actions/>
    </model>
    <model id="Cash Out" limit="20" query="true" createrowifnonefound="false" datasource="salesforce" sobject="Cash_Out__c">
      <fields>
        <field id="Amount__c"/>
        <field id="Name"/>
        <field id="CreatedBy.Name"/>
        <field id="Application__r.Name"/>
        <field id="Type__c"/>
        <field id="Purpose__c"/>
        <field id="Id"/>
      </fields>
      <conditions>
        <condition type="param" value="Id" field="Application__c" fieldtargetobjects="genesis__Applications__c" operator="=" enclosevalueinquotes="true" model="InvestmentBookModel"/>
      </conditions>
      <actions/>
    </model>
    <model id="Liabilities" limit="20" query="true" createrowifnonefound="false" datasource="salesforce" sobject="genesis__Liability__c">
      <fields>
        <field id="genesis__Liability_Type__c"/>
        <field id="Name"/>
        <field id="genesis__Amount_Owing__c"/>
      </fields>
      <conditions>
        <condition type="fieldvalue" value="true" enclosevalueinquotes="false" field="To_Be_Refinanced__c" model="InvestmentBookModel"/>
        <condition type="param" value="Id" field="genesis__Application__c" fieldtargetobjects="genesis__Applications__c" operator="=" enclosevalueinquotes="true" model="InvestmentBookModel"/>
      </conditions>
      <actions/>
    </model>
    <model limit="20" query="true" createrowifnonefound="false" datasource="salesforce" id="InvestmentBookModel" sobject="peer__Investment_Booking__c">
      <fields>
        <field id="peer__Investment_Amount__c"/>
        <field id="Invest__c"/>
        <field id="peer__Booking_Order__r.peer__Investor__c"/>
        <field id="peer__Booking_Order__r.peer__Investor__r.Name"/>
        <field id="peer__Certificate_Rate__c"/>
        <field id="peer__Service_Rate__c"/>
        <field id="peer__Stage__c"/>
        <field id="peer__Booking_Order__r.Id"/>
        <field id="peer__Booking_Order__c"/>
        <field id="peer__Booking_Order__r.Name"/>
        <field id="Id"/>
        <field id="peer__Loan_Application__c"/>
        <field id="peer__Loan_Application__r.Name"/>
      </fields>
      <conditions>
        <condition type="modelmerge" value="" field="peer__Loan_Application__c" fieldtargetobjects="peer__Loan_Application__c" operator="=" model="CommonApplicationModel" enclosevalueinquotes="true" mergefield="Loan_Application__c" novaluebehavior="deactivate"/>
        <condition type="fieldvalue" value="In Funding" enclosevalueinquotes="true" field="peer__Stage__c"/>
      </conditions>
      <actions/>
    </model>
    <model id="InvestmentOrder" limit="20" query="true" createrowifnonefound="false" datasource="salesforce" sobject="loan__Investor_Loan__c">
      <fields>
        <field id="loan__Account__c"/>
        <field id="loan__Account__r.Name"/>
        <field id="loan__Investment_Amount__c"/>
        <field id="loan__Service_Rate__c"/>
        <field id="loan__Certificate_Rate__c"/>
        <field id="loan__Status__c"/>
      </fields>
      <conditions>
        <condition type="modelmerge" value="" field="loan__Loan__c" fieldtargetobjects="loan__Loan_Account__c" operator="=" mergefield="peer__Loan__c" novaluebehavior="deactivate" model="Loan_Application" enclosevalueinquotes="true"/>
        <condition type="fieldvalue" value="Active" enclosevalueinquotes="true" field="loan__Status__c"/>
      </conditions>
      <actions/>
    </model>
    <model id="Amortization Schedule" limit="20" query="true" createrowifnonefound="false" datasource="salesforce" sobject="genesis__Amortization_Schedule__c">
      <fields>
        <field id="Name"/>
        <field id="genesis__Due_Date__c"/>
        <field id="genesis__Due_Interest__c"/>
        <field id="genesis__Due_Principal__c"/>
        <field id="genesis__Total_Due_Amount__c"/>
        <field id="genesis__Opening_Principal_Balance__c"/>
        <field id="genesis__Closing_Principal_Balance__c"/>
      </fields>
      <conditions>
        <condition type="modelmerge" value="" field="genesis__Application__c" fieldtargetobjects="genesis__Applications__c" operator="=" model="CommonApplicationModel" enclosevalueinquotes="true" mergefield="Id" novaluebehavior="deactivate"/>
      </conditions>
      <actions/>
    </model>
  </models>
  <components>
    <wrapper uniqueid="sk-1hSh-209">
      <components>
        <pagetitle uniqueid="sk-1hSj-222" model="CommonApplicationModel">
          <maintitle>Application :  {{Name}} - {{genesis__Status__c}}</maintitle>
          <actions>
            <action type="multi" uniqueid="sk-3x76-1317" label="Fund All">
              <actions>
                <action type="custom" snippet="Fund Investment Snippet"/>
              </actions>
              <renderconditions logictype="and">
                <rendercondition type="fieldvalue" operator="=" enclosevalueinquotes="true" fieldmodel="CommonApplicationModel" sourcetype="fieldvalue" field="Id" fieldtargetobjects="genesis__Applications__c" value="6745389"/>
              </renderconditions>
              <enableconditions/>
            </action>
            <action type="multi" label="List To Marketplace" uniqueid="sk-1iR1-375">
              <actions>
                <action type="custom" snippet="LoanApplicationConvert"/>
              </actions>
              <renderconditions logictype="and">
                <rendercondition type="fieldvalue" operator="=" enclosevalueinquotes="true" fieldmodel="CommonApplicationModel" sourcetype="fieldvalue" field="Id" fieldtargetobjects="genesis__Applications__c" value="57684390"/>
              </renderconditions>
              <enableconditions/>
            </action>
            <action type="multi" uniqueid="sk-1lbe-355" window="self" label="Save">
              <models>
                <model>Loan_Application</model>
                <model>Cash Out</model>
              </models>
              <actions>
                <action type="save" window="self" rollbackonanyerror="true">
                  <models>
                    <model>CommonApplicationModel</model>
                    <model>Loan_Application</model>
                    <model>Cash Out</model>
                    <model>InvestmentBookModel</model>
                    <model>BookingOrderModel</model>
                  </models>
                </action>
                <action type="custom" snippet="SaveChildObjects"/>
                <action type="blockUI" message="The changes have been succesfully saved!"/>
              </actions>
            </action>
            <action type="multi" label="Generate Schedule" uniqueid="sk-BSv-590">
              <actions>
                <action type="custom" snippet="generateSchedule"/>
              </actions>
            </action>
          </actions>
        </pagetitle>
        <wrapper uniqueid="sk-1hV2-851">
          <components>
            <basicfieldeditor showheader="true" showsavecancel="false" showerrorsinline="true" model="CommonApplicationModel" uniqueid="sk-1hTS-484" mode="edit">
              <columns>
                <column width="100%" uniqueid="sk-1hTS-482">
                  <sections>
                    <section uniqueid="sk-1hTS-483" collapsible="no">
                      <fields>
                        <columns uniqueid="sk-1hVM-907" layoutmode="fixed">
                          <column width="50%" uniqueid="sk-1hVM-894">
                            <sections>
                              <section title="New Section" collapsible="no" uniqueid="sk-1hVM-895" showheader="false">
                                <fields>
                                  <field uniqueid="sk-1hWr-540" id="genesis__Loan_Amount__c" snippet="fieldRenderer4"/>
                                  <field uniqueid="sk-BaM-724" id="genesis__Interest_Rate__c" snippet="fieldRenderer4"/>
                                  <field uniqueid="sk-1hWz-588" id="genesis__Interest_Only_Period__c" snippet="fieldRenderer4"/>
                                  <field uniqueid="sk-BbU-848" id="genesis__Interest_Calculation_Method__c" snippet="fieldRenderer4"/>
                                  <field uniqueid="sk-3tRq-557" id="genesis__Expected_Start_Date__c" snippet="fieldRenderer4"/>
                                </fields>
                              </section>
                            </sections>
                          </column>
                          <column width="50%" uniqueid="sk-1hVN-909">
                            <sections>
                              <section title="New Section" collapsible="no" uniqueid="sk-1hVN-910" showheader="false">
                                <fields>
                                  <field uniqueid="sk-3wav-810" id="genesis__Status__c" snippet="fieldRenderer4"/>
                                  <field uniqueid="sk-1hWt-554" id="genesis__Term__c" snippet="fieldRenderer4"/>
                                  <field uniqueid="sk-3wat-779" id="genesis__Payment_Frequency__c" snippet="fieldRenderer4">
                                    <renderconditions logictype="and" onhidedatabehavior="keep">
                                      <rendercondition type="multiple" operator="in" fieldmodel="CommonApplicationModel" sourcetype="fieldvalue" field="genesis__Payment_Frequency__c" fieldtargetobjects="genesis__Applications__c" value="" enclosevalueinquotes="true">
                                        <values>
                                          <value>WEEKLY</value>
                                          <value>BI-WEEKLY</value>
                                          <value>MONTHLY</value>
                                        </values>
                                      </rendercondition>
                                    </renderconditions>
                                    <enableconditions/>
                                  </field>
                                  <field uniqueid="sk-3tRr-561" id="genesis__Expected_First_Payment_Date__c" snippet="fieldRenderer4"/>
                                  <field uniqueid="sk-vu5-434" id="Loan_Application__c"/>
                                </fields>
                              </section>
                            </sections>
                          </column>
                        </columns>
                      </fields>
                    </section>
                  </sections>
                </column>
              </columns>
            </basicfieldeditor>
            <skootable showconditions="true" showsavecancel="false" showerrorsinline="true" searchmethod="server" searchbox="false" showexportbuttons="false" hideheader="false" hidefooter="false" pagesize="25" alwaysresetpagination="false" createrecords="false" model="Amortization Schedule" buttonposition="" mode="read" allowcolumnreordering="true" responsive="false" uniqueid="sk-BYT-484" emptysearchbehavior="query" heading="Repayment Schedule">
              <fields>
                <field id="genesis__Due_Date__c" hideable="true" uniqueid="fi-Ba5-687" snippet="fieldRenderer4"/>
                <field id="genesis__Opening_Principal_Balance__c" hideable="true" uniqueid="fi-Ba8-701" snippet="fieldRenderer4"/>
                <field id="genesis__Closing_Principal_Balance__c" hideable="true" uniqueid="fi-Ba9-707"/>
                <field id="genesis__Due_Principal__c" hideable="true" uniqueid="fi-Ba4-683"/>
                <field id="genesis__Due_Interest__c" hideable="true" uniqueid="fi-Ba3-679"/>
                <field id="genesis__Total_Due_Amount__c" hideable="true" uniqueid="fi-Ba2-675"/>
              </fields>
              <rowactions/>
              <massactions usefirstitemasdefault="true"/>
              <views>
                <view type="standard"/>
              </views>
              <searchfields/>
              <renderconditions logictype="and"/>
            </skootable>
          </components>
          <styles>
            <styleitem type="background"/>
            <styleitem type="border"/>
            <styleitem type="size"/>
          </styles>
          <renderconditions logictype="and"/>
        </wrapper>
      </components>
      <styles>
        <styleitem type="background"/>
        <styleitem type="border"/>
        <styleitem type="size"/>
      </styles>
      <renderconditions logictype="and"/>
    </wrapper>
  </components>
  <resources>
    <labels/>
    <javascript>
      <jsitem location="inlinesnippet" name="convertToLoan" cachelocation="false">var params = arguments[0],
	$ = skuid.$;
var appModel = skuid.model.getModel('CommonApplicationModel');
var appRow = appModel.data[0];
var agree = confirm("Are you sure?");
if(agree){
    $.blockUI({
        message: 'Please wait! Loan Contract is being generated!',
        onBlock:function(){
             var ret = sforce.apex.execute('ConvertToContract','executeFun',
            {
                appId : appRow.Id
            });
            alert(ret);
        }
    });
}
window.location.reload();</jsitem>
      <jsitem location="inlinesnippet" cachelocation="false" name="LoanApplicationConvert">var params = arguments[0],
	$ = skuid.$;
var appModel = skuid.model.getModel('CommonApplicationModel');
var appRow = appModel.data[0];
var agree = confirm("Are you sure ?");
if (agree){
    $.blockUI({
   message: 'Please wait!  Application is listing to marketplace...',
   onBlock:function(){
    try {
        var ret = sforce.apex.execute('LoanApplicationConvert','convertLoanApplicationCtrl',
        {   
            appId : appRow.Id
        });
        if(ret[0].includes('Application Converted Successfully.')){
            alert(ret);
            $.unblockUI();
            window.location.reload();
        }else{
            alert(ret);
            $.unblockUI();
        }
    } catch(err) {
        alert(err);
        $.unblockUI();
    }
   }
    });
}</jsitem>
      <jsitem location="inlinesnippet" cachelocation="false" name="SaveChildObjects">var params = arguments[0],
	$ = skuid.$;
	var appModel = skuid.model.getModel('CommonApplicationModel');
	var appRow = appModel.data[0];
	var i=0,k=0;
var cashModel = skuid.model.getModel('Cash Out');
for(var eachCashOut in cashModel){
    var cashData = eachCashOut.data[k];
    cashData.Application__c = appRow.Id;
    k++;
}</jsitem>
      <jsitem location="inlinesnippet" cachelocation="false" name="Fund Investment Snippet">var params = arguments[0],
    $ = skuid.$;
$xml = skuid.utils.makeXMLDoc;
var context = {};
var appModel = skuid.model.getModel('Loan_Application');
var appRow = appModel.data[0];
var appModel1 = skuid.model.getModel('CommonApplicationModel');
var appRow1 = appModel1.data[0];

var agree = confirm("Are you sure ?");
if (agree){
    $.blockUI({
   message: 'Please wait!  Investors money is getting funded...',
   onBlock:function(){
        try {
            var ret = sforce.apex.execute('Invest','makeAllInvestment',
            {   
                iden : appRow.Id
            });
            alert(ret);
            $.unblockUI();
            
        } catch(err) {
            alert(err);
            $.unblockUI();
            //window.location.reload();
        }
   }
   
    });
    
}
window.location.reload();
</jsitem>
      <jsitem location="inlinesnippet" name="generateSchedule" cachelocation="false">var params = arguments[0],
    $ = skuid.$;
	$xml = skuid.utils.makeXMLDoc;
	var context = {};

    var scModels = skuid.model.getModel('CommonApplicationModel');
    var scRow = scModels.data[0]; 
    var agree = confirm("Are you sure ?");
    if (agree){
        $.blockUI({
       message: 'Please wait!  Schedule is generating...',
       onBlock:function(){
        var result = sforce.apex.execute('genesis.SkuidNewApplication','generateSchedule',
        {   
                applicationId : scRow.Id
        });
        console.log(result);
        $.unblockUI();
        
        alert(result);
       }
       });
        window.location.reload();
    }
</jsitem>
      <jsitem location="inlinesnippet" name="fieldRenderer4" cachelocation="false">var field = arguments[0],
    value = arguments[1];
var renderMode = skuid.page.params.mode;
fieldModeToRender(field,value,renderMode);</jsitem>
    </javascript>
    <css/>
    <actionsequences uniqueid="sk-1hSz-322"/>
  </resources>
  <styles>
    <styleitem type="background" bgtype="none"/>
  </styles>
</skuidpage>